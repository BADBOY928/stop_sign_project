<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<div class="jumbotron jumbotron_img_responsive" id="header">
  <h1 class="display-3">Stop Sign Detector</h1>
</div>
<hr>
<div class="row">
  <div class="col">
    <h3>So there's this Stop Sign</h3>
    <img src="http://i.imgur.com/yxzMhh4.png" class="img-fluid" />
  </div>
</div>
<hr>
<div class="row">
  <h2>Everyone Runs this Sign</h2>
</div>
<div class="row">
  <div class="col-sm-4">
    <img class="img-responsive" style="width:100% ;padding-top: 2px" src="http://i.imgur.com/9RKrizy.gif" />
  </div>
  <div class="col-sm-4">
    <img class="img-responsive" style="width:100% ;padding-top: 2px" src="http://i.imgur.com/4aPfN1o.gif" />
  </div>
  <div class="col-sm-4">
    <img class="img-responsive" style="width:100% ;padding-top: 2px" src="http://i.imgur.com/vgWoO74.gif" />
  </div>
  <div class="col-sm-4">
    <img class="img-responsive" style="width:100% ;padding-top: 2px" src="http://i.imgur.com/YVhuF4X.gif" />
  </div>
  <div class="col-sm-4">
    <img class="img-responsive" style="width:100% ;padding-top: 2px" src="http://i.imgur.com/J9Ws2jZ.gif" />
  </div>
  <div class="col-sm-4">
    <img class="img-responsive" style="width:100% ;padding-top: 2px" src="http://i.imgur.com/vGNHUeA.gif" />
  </div>
  <div class="col-sm-4">
    <img class="img-responsive" style="width:100% ;padding-top: 2px" src="http://i.imgur.com/FTAsNQp.gif" />
  </div>
  <div class="col-sm-4">
    <img class="img-responsive" style="width:100% ;padding-top: 2px" src="http://i.imgur.com/xX7EvvA.gif" />
  </div>
  <div class="col-sm-4">
    <img class="img-responsive" style="width:100% ;padding-top: 2px" src="http://i.imgur.com/h8YfYmJ.gif" />
  </div>
</div>
<hr>
<div class="row">
  <div class="col-sm-12">
    <h2>My house has a good view of it from the back...</h2>
    <div class="embed-responsive embed-responsive-16by9">
      <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/jPK0Q58wMNg?rel=0&amp;controls=0&amp;showinfo=0" frameborder="0" allowfullscreen></iframe>
    </div>
  </div>
</div>
<hr>
<div class="row text-center">
  <div class="col-sm-12">
    <h2>But of course, I can't spend time counting cars...</h2>
    <p><b>But a webcam attached to a Raspberry Pi sure can</b></p>
    <img class="img img-responsive" src="http://i.imgur.com/nolbmkf.jpg" />
  </div>
</div>
<hr>
<div class="row">
  <h2>üìä Current Stats ‚è±Ô∏è</h2>
</div>
<div class="row">
  <div id="chart_div"></div>
  <script>
    google.charts.load('current', {packages: ['corechart', 'bar']});
    google.charts.setOnLoadCallback(drawBasic);

    function drawBasic() {

          var data = new google.visualization.DataTable();
          data.addColumn('timeofday', 'Time of Day');
          data.addColumn('number', 'Motivation Level');

          data.addRows([
            [{v: [8, 0, 0], f: '8 am'}, 1],
            [{v: [9, 0, 0], f: '9 am'}, 2],
            [{v: [10, 0, 0], f:'10 am'}, 3],
            [{v: [11, 0, 0], f: '11 am'}, 4],
            [{v: [12, 0, 0], f: '12 pm'}, 5],
            [{v: [13, 0, 0], f: '1 pm'}, 6],
            [{v: [14, 0, 0], f: '2 pm'}, 7],
            [{v: [15, 0, 0], f: '3 pm'}, 8],
            [{v: [16, 0, 0], f: '4 pm'}, 9],
            [{v: [17, 0, 0], f: '5 pm'}, 10],
          ]);

          var options = {
            title: 'Motivation Level Throughout the Day',
            hAxis: {
              title: 'Time of Day',
              format: 'h:mm a',
              viewWindow: {
                min: [7, 30, 0],
                max: [17, 30, 0]
              }
            },
            vAxis: {
              title: 'Rating (scale of 1-10)'
            }
          };

          var chart = new google.visualization.ColumnChart(
            document.getElementById('chart_div'));

          chart.draw(data, options);
        }
  </script>
</div>


<div class="row">
  <div class="col">
    <%= @stats.observation_period_count.delimited %> Total scans, <%= @stats.stop_sign_log_count.delimited %> total suspected cases
  </div>
  <div class="col">
    <%= (@stats.seconds_observed/60/60).to_i.delimited %>+ Hours collected, spanning <%= (@stats.total_study_time/60/60/24).to_i.delimited %> days
  </div>
</div>
<div class="row">
  <div class="col">
    ‚âà<%= MachineLearner.first(vote_method: "presence").estimated_count.delimited %> total cars seen, ‚âà<%= MachineLearner.first(vote_method: "full_scene").estimated_count.delimited %> seen long enough to measure. An estimated ‚âà<%= ((@stats.total_study_time/@stats.seconds_observed)*MachineLearner.first(vote_method: "presence").estimated_count).to_i.delimited %> cars have passed the sign, with an average of ‚âà<%= (((@stats.total_study_time/@stats.seconds_observed)*MachineLearner.first(vote_method: "presence").estimated_count) / (@stats.total_study_time/60/60/24)).to_i.delimited %> per day.
  </div>
</div>
<div class="row">
  <div class="col">
    Machine learning on stop violations is still pending - too few actual stops to accurately assess. As of now, <%= (@stats.current_violation_votes[0] / @stats.current_violation_votes.sum).round(4) * 100 %>% of all stops are violations according to human assessment, leading to an estimated <%= (MachineLearner.first(vote_method: "presence").estimated_count*((@stats.current_violation_votes[0] / @stats.current_violation_votes.sum).round(4))).to_i.delimited %> observed violations, with an estimated ‚âà<%= ((@stats.total_study_time/@stats.seconds_observed)*(MachineLearner.first(vote_method: "presence").estimated_count*((@stats.current_violation_votes[0] / @stats.current_violation_votes.sum).round(4)))).to_i.delimited %> total stop sign runs since monitoring began.
  </div>
</div>
<hr />
<div class="row">
  <h2>üèãÔ∏è Help Train the Machine üèãÔ∏è</h2>
</div>
<div class="row">
  <div class="col">
    <h3><a href="/train/presence">Train Car Presence</a></h3>
    <%= @stats.presence_vote_count.delimited %> total votes recorded
    <% if MachineLearner.first(vote_method: "presence") %>
      <p>Current Machine Accuracy: <%= MachineLearner.first(vote_method: "presence").accuracy %>% (<a href="/machine/presence">see examples</a>)</p>
    <% end %>
  </div>
  <div class="col">
    <h3><a href="/train/full_scene">Train Full Scene Check</a></h3>
    <%= @stats.full_scene_vote_count.delimited %> total votes recorded
    <% if MachineLearner.first(vote_method: "full_scene") %>
      <p>Current Machine Accuracy: <%= MachineLearner.first(vote_method: "full_scene").accuracy %>% (<a href="/machine/full_scene">see examples</a>)</p>
    <% end %>
  </div>
</div>
<div class="row">
  <div class="col">
    <h3><a href="/train/stop_violations">Train Stop Violations</a></h3>
    <%= @stats.stop_violations_vote_count.delimited %> total votes recorded
    <% if MachineLearner.first(vote_method: "stop_violations") %>
      <p>Current Machine Accuracy: <%= MachineLearner.first(vote_method: "stop_violations").accuracy %>% (<a href="/machine/stop_violations">see examples</a>)</p>
    <% end %>
  </div>
  <div class="col">
    <h3><a href="/train/wrong_way_violations">Train Wrong Way Violations</a></h3>
    <%= @stats.wrong_way_violations_vote_count.delimited %> total votes recorded
    <% if MachineLearner.first(vote_method: "wrong_way_violations") %>
      <p>Current Machine Accuracy: <%= MachineLearner.first(vote_method: "wrong_way_violations").accuracy %>% (<a href="/machine/wrong_way_violations">see examples</a>)</p>
    <% end %>
  </div>
</div>
<hr />
<footer>
  <a href="http://devingaffney.com">Devin, 2017</a> | <a href="http://github.com/DGaffney/stop_sign_project">GitHub</a>
</footer>
